# Render Deployment Fix Guide

## Problem
The deployment was failing with:
```
ModuleNotFoundError: No module named 'app'
```

This occurred because Render was trying to run `gunicorn app:app` instead of the correct Django WSGI application.

## Solution Applied

### 1. Updated `render.yaml`
- Changed start command to: `gunicorn config.wsgi:application -c gunicorn_config.py`
- Added explicit environment variables:
  - `DJANGO_SETTINGS_MODULE=config.settings`
  - `SECRET_KEY` (auto-generated by Render)
  - `DEBUG=False` (for production)
  - `ALLOWED_HOSTS=.onrender.com`

### 2. Created `gunicorn_config.py`
A dedicated Gunicorn configuration file with:
- Proper port binding (`0.0.0.0:$PORT`)
- Worker configuration
- Logging settings
- Production-ready timeouts

### 3. Updated `config/settings.py`
- Now reads environment variables using `python-dotenv`
- `SECRET_KEY` from environment (with fallback)
- `DEBUG` from environment (defaults to False)
- `ALLOWED_HOSTS` from environment

## Next Steps

### In Render Dashboard:
1. Go to your service settings
2. **Verify the Start Command** is set to:
   ```
   gunicorn config.wsgi:application -c gunicorn_config.py
   ```
   Or leave it blank to use `render.yaml`

3. **Add Environment Variables** (if not already set):
   - `GEMINI_API_KEY`: Your Gemini API key
   - `MONGODB_URI`: Your MongoDB connection string
   - `SECRET_KEY`: Will be auto-generated
   - `DEBUG`: False
   - `ALLOWED_HOSTS`: .onrender.com

4. **Trigger a Manual Deploy**:
   - Click "Manual Deploy" → "Deploy latest commit"

## Verification

After deployment, check:
1. Build logs show successful installation
2. Start command uses the correct WSGI application
3. Service starts without errors
4. You can access your site at `https://your-app.onrender.com`

## Troubleshooting

### If you still see "No module named 'app'":
1. Check Render Dashboard → Settings → Start Command
2. Ensure it's NOT set to `gunicorn app:app`
3. Either clear it (to use render.yaml) or set it to:
   ```
   gunicorn config.wsgi:application -c gunicorn_config.py
   ```

### If static files don't load:
1. Ensure `build.sh` runs `collectstatic`
2. Check that `whitenoise` is in `requirements.txt`
3. Verify `STATIC_ROOT` is set in settings.py

### If you see database errors:
1. Check that migrations run in `build.sh`
2. Verify MongoDB connection string is correct
3. Ensure `MONGODB_URI` environment variable is set

## Important Notes

- **Never commit `.env` file** - it's in `.gitignore`
- **Use Render's environment variables** for secrets
- **Keep DEBUG=False** in production
- **Monitor logs** after deployment for any issues

## Files Modified
- `render.yaml` - Updated start command and environment variables
- `config/settings.py` - Added environment variable support
- `gunicorn_config.py` - Created new Gunicorn configuration
